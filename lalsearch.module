<?php
/**
 * Display help and module information
 * @param path which path of the site we're displaying help
 * @param arg array that holds the current path as would be returned from arg() function
 * @return help text for the path
 */
function lalsearch_help($path, $arg) {
  $output = '';
  switch ($path) {
    case "admin/help#lalsearch":
      $output = '<p>'.  t("Searches into LAL metadata repository") .'</p>';
      break;
  }
  return $output;
} //function lalsearch_help

/**
 * Implementation of hook_block().
 * @param string $op one of "list", "view", "save" and "configure"
 * @param integer $delta code to identify the block
 * @param array $edit only for "save" operation
*/
function lalsearch_block($op = 'list', $delta = 0) {  
  $block = array();
  if ($op == "list") {
    // Generate listing of blocks from this module, for the admin/block page
#    $block = array();
    $block[0]['info'] = t('LAL Search');
    return $block;
  } 
  else if ($op == "view") {
    //Fake content
    $block_content = "First<br />Second<br />Third<br />";
    $block['subject'] = "Search results";
    $block['content'] = $block_content;
    return $block;
  }
  return $block;
} // function lalsearch_block

/**
* Valid permissions for this module
* @return array An array of valid permissions for the lalsearch module
*/
function lalsearch_perm() {
  return array('accesss LAL metadata content');
} // function lalsearch_perm()

function lalsearch_admin() {
  $form = array();
  
  $form['lalsearch_maxresults'] = array(
    '#type' => 'textfield',
    '#title' => t('Maximum number of results'),
    '#default_value' => variable_get('lalserach_maxresults', 20),
    '#size' => 2,
    '#maxlength' => 2,
    '#description' => t('The maximum number of search results per page'),
    '#required' => TRUE,
  );
  
  return system_settings_form($form);
}

function lalsearch_menu() {
  $items = array();
	
  $items['admin/settings/lalsearch'] = array(
  	'title' => t('LAL search module settings'),
  	'description' => t('LAL search module settings page'),
  	'page callback' => 'drupal_get_form',
  	'page arguments' => array('lalsearch_admin'),
  	'access arguments' => array('access administration pages'),
  	'type' => MENU_NORMAL_ITEM,
  );
  
  return $items;
}

function lalsearch_admin_validate($form, &$form_state) {
	$maxresults = $form_state['values']['lalsearch_maxresults'];
	if (!is_numeric($maxresults)) {
		form_set_error('lalsearch_maxresults',t('You must enter an integer for the maximum number of results'));
	}
	else if ($maxresults <= 0) {
		form_set_error('lalsearch_maxresults', t('Maximum number of results must be positive'));
	}
}
